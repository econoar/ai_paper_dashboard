{% extends "base.html" %}

{% block content %}
  <h1>Bookmarked Papers</h1>
  <table class="table table-striped table-bordered" id="bookmarksTable">
    <thead>
      <tr>
        <th>Time (PST)</th>
        <th>Tags</th>
        <th>Title</th>
        <th>Abstract Excerpt</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <!-- Bookmark data will be dynamically inserted via JavaScript -->
    </tbody>
  </table>
  <a href="{{ url_for('index') }}" class="btn btn-secondary">Back to Papers</a>

  <script>
    $(document).ready(function(){
      var bookmarks = JSON.parse(localStorage.getItem('bookmarksData')) || [];
      var tbody = $("#bookmarksTable tbody");
      tbody.empty();
      if (bookmarks.length === 0) {
          tbody.append("<tr><td colspan='5'>No bookmarks yet.</td></tr>");
      } else {
          bookmarks.forEach(function(paper){
              // Create a short excerpt from the summary
              var excerpt = "";
              if (paper.summary && paper.summary.length > 200) {
                  excerpt = paper.summary.substring(0, 200) + "...";
              } else {
                  excerpt = paper.summary || "No abstract available.";
              }
              // Build a row that mimics your main page layout
              var row = "<tr>" +
                  "<td>" + (paper.time || "") + "</td>" +
                  "<td>" + (paper.tags && paper.tags.length > 0 ? paper.tags.join(", ") : "N/A") + "</td>" +
                  "<td>" + paper.title + "</td>" +
                  "<td>" + excerpt + "</td>" +
                  "<td>" +
                    "<div class='d-flex flex-column'>" +
                      "<button class='btn btn-secondary btn-sm mb-2 more-info-btn' " +
                              "data-id='" + paper.id + "' " +
                              "data-title='" + paper.title + "' " +
                              "data-tags='" + (paper.tags ? paper.tags.join(", ") : "N/A") + "' " +
                              "data-published='" + paper.published + "' " +
                              "data-time='" + (paper.time || "") + "' " +
                              "data-link='" + paper.link + "' " +
                              "data-pdf='" + paper.pdf_link + "' " +
                              "data-summary='" + (paper.summary || "").replace(/\n/g, ' ') + "'>" +
                          "<i class='fas fa-info-circle'></i> More Info" +
                      "</button>" +
                      "<button class='btn btn-success btn-sm mb-2 summarize-btn' data-paper-id='" + paper.id + "'>" +
                          "<i class='fas fa-lightbulb'></i> Summarize" +
                      "</button>" +
                      "<button class='btn btn-warning btn-sm bookmark-btn mb-2' data-paper-id='" + paper.id + "'>" +
                          "<i class='far fa-star'></i> Bookmark" +
                      "</button>" +
                    "</div>" +
                  "</td>" +
                  "</tr>";
              tbody.append(row);
          });
      }
    });
  </script>
{% endblock %}